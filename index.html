<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Familienquizz</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f2f2f2; }
    #app { max-width: 800px; margin: auto; padding: 20px; }
    .hidden { display: none; }
    .grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px; width: 100%; max-width: 600px; margin: 20px auto; }
    .tile { width: 100%; padding-top: 100%; background: #444; background-size: cover; transition: background 0.3s ease; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #333; padding: 5px; text-align: center; }
    th { background: #ddd; }
  </style>
</head>
<body>
<div id="app">
  <h1>Familienquizz</h1>
  
  <div id="startScreen">
    <p>Bitte Namen eingeben:</p>
    <input id="playerName" type="text" style="padding:10px; font-size:16px;" />
    <button onclick="startGame()">Start</button>
  </div>

  <div id="questionScreen" class="hidden">
    <h2 id="questionText"></h2>
    <div id="imageArea"></div>
    <div id="answers"></div>
  </div>

  <div id="resultScreen" class="hidden">
    <h2>Auswertung</h2>
    <p id="score"></p>
    <p id="time"></p>
    <h3>Leaderboard</h3>
    <div id="leaderboard"></div>
  </div>
</div>

<script>
const questions = [
{ q: "Wie heißt dieses Spiel?", img: "Spiel.jpg", answers: ["Malefiz","Mensch ärgere dich nicht","Rummikub","Megalon"], correct: 0 },
{ q: "In welcher Jahreszeit ist dieses Bild aufgenommen worden?", img: "Weinberg.jpg", answers: ["Frühling","Sommer","Herbst","Winter"], correct: 0 },
{ q: "Was wird hier gespielt?", img: "Spiel.jpg", answers: ["Sackhüpfen","Eierlauf","Wikinger Schach","Boules"], correct: 1 },
{ q: "Wie viele Hunde sehen wir hier?", img: "Hund.jpg", answers: ["nur Ziegen","5","2","3"], correct: 3 },
{ q: "In welcher Stadt befinden wir uns hier?", img: "Stadt.jpg", answers: ["Tübingen","Göttingen","Düsseldorf","Heidelberg"], correct: 3 },
{ q: "Was wird hier gefeiert?", img: "Abschluss.jpg", answers: ["Berufsausbildung","Geburtstag","Schulabschluss","Tanzschulball"], correct: 2 },
{ q: "An welchem Tag ist dieses Bild entstanden?", img: "Freitag.jpg", answers: ["Samstag","Freitag","Sonntag","Dienstag"], correct: 1 },
{ q: "Wie heißt dieser Herr?", img: "Papst.jpg", answers: ["Franziskus","Johannes","Linus","Leo"], correct: 3 },
{ q: "In welchem Land wurde dieses Bild aufgenommen?", img: "Land.jpg", answers: ["Portugal","Türkei","Spanien","Frankreich"], correct: 2 },
{ q: "Welchen Vogel sehen wir hier?", img: "Vogel.jpg", answers: ["Turmfalke","Wanderfalke","Habicht","Bussard"], correct: 1 },
{ q: "Welche Sprache wird hier gesprochen?", img: "CostaRica.jpg", answers: ["Spanisch","Portugiesisch","Englisch","Französisch"], correct: 0 },
{q : "Wie viele Menschen sehen wir hier?", img: "Family.jpg", answers: ["21","19","22","23"], correct: 2 }
];

let current = 0;
let correctCount = 0;
let startTime;
let player;

function startGame() {
  player = document.getElementById("playerName").value.trim();
  if (!player) return alert("Bitte Namen eingeben");
  document.getElementById("startScreen").classList.add("hidden");
  startTime = Date.now();
  loadQuestion();
}

function loadQuestion() {
  document.getElementById("questionScreen").classList.remove("hidden");
  const q = questions[current];
  document.getElementById("questionText").textContent = q.q;

  const area = document.getElementById("imageArea");
  area.innerHTML = "";

  const grid = document.createElement("div");
  grid.className = "grid";

  const gridSize = 6; 
  const tiles = [];

  // --- CREATE PUZZLE TILES ---
  for (let row = 0; row < gridSize; row++) {
    for (let col = 0; col < gridSize; col++) {
      const t = document.createElement("div");
      t.className = "tile";

      // show only a part of the image
      t.style.backgroundImage = `url(${q.img})`;
      t.style.backgroundSize = `${gridSize * 100}% ${gridSize * 100}%`;
      t.style.backgroundPosition = `${(col / (gridSize - 1)) * 100}% ${(row / (gridSize - 1)) * 100}%`;

      // start hidden
      t.style.opacity = 0;
      t.style.transition = "opacity 0.3s ease";

      tiles.push(t);
      grid.appendChild(t);
    }
  }

  area.appendChild(grid);

  // --- REVEAL TILES GRADUALLY ---
  const revealSpeed = 400;
  const revealInterval = setInterval(() => {
    if (tiles.length === 0) {
      clearInterval(revealInterval);
      return;
    }

    const r = Math.floor(Math.random() * tiles.length);
    const tile = tiles.splice(r, 1)[0];

    // reveal tile by opacity, NOT background reset
    tile.style.opacity = 1;
  }, revealSpeed);

  // --- ANSWERS ---
  const ans = document.getElementById("answers");
  ans.innerHTML = "";

  q.answers.forEach((a, i) => {
    const b = document.createElement("button");
    b.textContent = a;
    b.onclick = () => answer(i);
    ans.appendChild(b);
  });
}


const revealSpeed = 300;

const revealInterval = setInterval(() => {
    if (tiles.length === 0) {
        clearInterval(revealInterval);
        return;
    }

    const r = Math.floor(Math.random() * tiles.length);
    const tile = tiles.splice(r, 1)[0];

    // reveal correct tile
    tile.style.opacity = "1";
}, revealSpeed);


  const ans = document.getElementById("answers");
  ans.innerHTML = "";

  q.answers.forEach((a, i) => {
    const b = document.createElement("button");
    b.textContent = a;
    b.onclick = () => answer(i);
    ans.appendChild(b);
  });
}

function answer(i) {
  if (i === questions[current].correct) correctCount++;
  current++;
  if (current >= questions.length) finish();
  else loadQuestion();
}

function finish() {
  document.getElementById("questionScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");

  const time = Math.round((Date.now() - startTime) / 1000);
  document.getElementById("score").textContent = `Richtige Antworten: ${correctCount}`;
  document.getElementById("time").textContent = `Zeit: ${time} Sekunden`;

  // Spielergebnis speichern
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
  leaderboard.push({ name: player, score: correctCount, time: time });

  // Sortieren: Score absteigend, Zeit aufsteigend bei Gleichstand
  leaderboard.sort((a,b) => b.score - a.score || a.time - b.time);
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

  // Tabelle erzeugen
  const lbDiv = document.getElementById("leaderboard");
  lbDiv.innerHTML = "";

  const table = document.createElement("table");
  const header = document.createElement("tr");
  ["Rang", "Spieler", "Punkte", "Zeit (s)"].forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    header.appendChild(th);
  });
  table.appendChild(header);

  leaderboard.forEach((entry, index) => {
    const tr = document.createElement("tr");
    [index + 1, entry.name, entry.score, entry.time].forEach(text => {
      const td = document.createElement("td");
      td.textContent = text;
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });

  lbDiv.appendChild(table);
}
</script>
</body>
</html>
